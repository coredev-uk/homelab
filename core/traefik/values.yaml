# Traefik Helm Values
# Based on our current homelab configuration

# Set Traefik as the default ingress class
ingressClass:
  enabled: true
  isDefaultClass: true

# Enable dashboard with insecure mode for internal access
api:
  dashboard: true
  insecure: true

# Enable dashboard IngressRoute
ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.home.coredev.uk`)
    entryPoints:
      - web

# Configure entrypoints
ports:
  web:
    port: 80
    exposedPort: 80
  websecure:
    port: 443
    exposedPort: 443
  traefik:
    port: 8080
    exposedPort: 8080

# Configure providers
providers:
  kubernetesIngress:
    enabled: true
  kubernetesCRD:
    enabled: true

# Configure ACME/Let's Encrypt
certificatesResolvers:
  letsencrypt:
    acme:
      email: admin@coredev.uk
      storage: /data/acme.json
      httpChallenge:
        entryPoint: web

# Configure service with LoadBalancer and specific IP
service:
  type: LoadBalancer
  spec:
     loadBalancerIP: 10.147.10.27
    externalTrafficPolicy: Local

# Configure persistence for ACME certificates
persistence:
  enabled: true
  storageClass: longhorn
  size: 1Gi

# Resource limits
resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

# Disable version checking and anonymous usage, enable real IP forwarding
globalArguments:
  - "--global.checknewversion=false"
  - "--global.sendanonymoususage=false"
  - "--entryPoints.web.forwardedHeaders.trustedIPs=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
  - "--entryPoints.websecure.forwardedHeaders.trustedIPs=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16"
  - "--entryPoints.web.forwardedHeaders.insecure=false"
  - "--entryPoints.websecure.forwardedHeaders.insecure=false"

# Install in traefik namespace
namespaceOverride: traefik

