apiVersion: v1
kind: ConfigMap
metadata:
  name: security-hardening-policy
  namespace: kube-system
data:
  policy.yaml: |
    apiVersion: kyverno.io/v1
    kind: Policy
    metadata:
      name: disallow-privileged-containers
    spec:
      validationFailureAction: enforce
      background: true
      rules:
      - name: check-privileged
        match:
          any:
          - resources:
              kinds:
              - Pod
        validate:
          message: "Privileged containers are not allowed except for specific system pods"
          pattern:
            spec:
              =(securityContext):
                =(privileged): "false"
              containers:
              - name: "*"
                =(securityContext):
                  =(privileged): "false"
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: security-recommendations
  namespace: kube-system
data:
  README.md: |
    # Security Hardening Applied
    
    ## Changes Made:
    1. Traefik dashboard secured with basic auth
    2. Privileged containers replaced with specific capabilities
    3. Network policies implemented for traffic segmentation
    4. Pod Security Standards applied to namespaces
    5. Resource limits ensured for all containers
    
    ## Manual Steps Required:
    1. Change default Traefik dashboard password in core/traefik/dashboard-auth.yaml
       - Generate new password: htpasswd -nb admin yourpassword
    2. Apply network policies and test connectivity
    3. Monitor pod security violations in restricted namespaces
    
    ## Security Monitoring:
    - Monitor failed pod creations due to security policies
    - Set up alerts for privilege escalation attempts
    - Regular security scans of container images recommended