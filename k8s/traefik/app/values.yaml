# Traefik Helm Chart Values
# Chart version: 38.0.1
# App version: v3.6.5

ingressClass:
  enabled: true
  isDefaultClass: true

ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.home.coredev.uk`)
    entryPoints: ["websecure"]
    middlewares:
      - name: tinyauth-forwardauth
        namespace: pocket-id
    tls:
      secretName: traefik-dashboard-tls

ports:
  web:
    port: 8000
    exposedPort: 80
    expose:
      default: true
    forwardedHeaders:
      trustedIPs:
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
      insecure: false
  websecure:
    port: 8443
    exposedPort: 443
    expose:
      default: true
    forwardedHeaders:
      trustedIPs:
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
      insecure: false
    http:
      encodedCharacters:
        allowEncodedSlash: true
  traefik:
    port: 9000
    exposedPort: 8080
    expose:
      default: true

providers:
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true

service:
  type: LoadBalancer
  spec:
    loadBalancerIP: 192.168.20.30
  labels:
    tinyauth.apps.traefik.oauth.groups: cluster_admin

persistence:
  enabled: true
  storageClass: longhorn
  size: 250Mi
  path: /data

resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

globalArguments:
  - "--global.checknewversion=false"
  - "--global.sendanonymoususage=false"

metrics:
  prometheus:
    enabled: true
    addEntryPointsLabels: true
    addServicesLabels: true
    serviceMonitor:
      enabled: true  # Enabled - Prometheus installed first via dependsOn
      additionalLabels:
        release: kube-prometheus-stack
