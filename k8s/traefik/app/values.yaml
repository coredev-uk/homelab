# Traefik Helm Chart Values
# Chart version: 38.0.1
# App version: v3.6.5

ingressClass:
  enabled: true
  isDefaultClass: true

ingressRoute:
  dashboard:
    enabled: true
    matchRule: Host(`traefik.home.coredev.uk`)
    entryPoints: ["websecure"]
    middlewares:
      - name: tinyauth-forwardauth
        namespace: tinyauth
    tls:
      secretName: traefik-dashboard-tls

ports:
  web:
    port: 8000
    exposedPort: 80
    expose:
      default: true
    forwardedHeaders:
      trustedIPs:
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
      insecure: false
  websecure:
    port: 8443
    exposedPort: 443
    expose:
      default: true
    forwardedHeaders:
      trustedIPs:
        - 10.0.0.0/8
        - 172.16.0.0/12
        - 192.168.0.0/16
      insecure: false
    http:
      encodedCharacters:
        allowEncodedSlash: true
      tls:
        enabled: true
  traefik:
    port: 9000
    exposedPort: 8080
    expose:
      default: true

providers:
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true
  kubernetesCRD:
    enabled: true
    allowCrossNamespace: true
  kubernetesGateway:
    enabled: true

gatewayClass:
  enabled: true

gateway:
  enabled: true
  annotations:
    cert-manager.io/cluster-issuer: letsencrypt-prod
  listeners:
    web:
      port: 8000
      protocol: HTTP
      hostname: "*.home.coredev.uk"
      namespacePolicy: All
    websecure:
      port: 8443
      protocol: HTTPS
      hostname: "*.home.coredev.uk"
      namespacePolicy: All
      certificateRefs:
        - name: wildcard-home-coredev-uk-tls
          namespace: traefik

service:
  type: LoadBalancer
  spec:
    loadBalancerIP: 192.168.20.30

persistence:
  enabled: true
  storageClass: longhorn
  size: 250Mi
  path: /data

resources:
  requests:
    memory: "128Mi"
    cpu: "100m"
  limits:
    memory: "512Mi"
    cpu: "500m"

metrics:
  prometheus:
    enabled: true
    addEntryPointsLabels: true
    addServicesLabels: true
    serviceMonitor:
      enabled: true  # Enabled - Prometheus installed first via dependsOn
      additionalLabels:
        release: kube-prometheus-stack
