# Loki configuration for SingleBinary deployment mode
deploymentMode: SingleBinary

loki:
  auth_enabled: false
  commonConfig:
    replication_factor: 1
  storage:
    type: 'filesystem'
  schemaConfig:
    configs:
      - from: "2024-01-01"
        store: tsdb
        object_store: filesystem
        schema: v13
        index:
          prefix: loki_index_
          period: 24h

# SingleBinary configuration
singleBinary:
  replicas: 1
  persistence:
    enabled: true
    storageClass: longhorn
    size: 10Gi
  resources:
    requests:
      memory: "512Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "500m"

# Disable other deployment modes
backend:
  replicas: 0
read:
  replicas: 0
write:
  replicas: 0

# Optimized cache configuration for homelab (reduced from production defaults)
# chunks-cache: 1.5GB (down from 9.6GB) - stores compressed log chunks
# results-cache: 512MB (down from 1.2GB) - stores query results
chunksCache:
  enabled: true
  replicas: 1
  allocatedMemory: 1536  # 1.5GB for memcached
  resources:
    requests:
      cpu: 100m
      memory: 1536Mi
    limits:
      cpu: 500m
      memory: 1843Mi  # 1536 * 1.2 for overhead

resultsCache:
  enabled: true
  replicas: 1
  allocatedMemory: 512  # 512MB for memcached
  resources:
    requests:
      cpu: 50m
      memory: 512Mi
    limits:
      cpu: 200m
      memory: 614Mi  # 512 * 1.2 for overhead

# Monitoring integration
monitoring:
  serviceMonitor:
    enabled: true
  selfMonitoring:
    enabled: false
    grafanaAgent:
      installOperator: false

# Disable test pod
test:
  enabled: false

# Gateway (nginx) for Loki
gateway:
  enabled: true
  replicas: 1
  service:
    annotations:
      glance/name: "Loki"
      glance/icon: "si:loki"
      glance/url: "http://loki-gateway.monitoring.svc.cluster.local"
      glance/description: "Log Aggregation"
