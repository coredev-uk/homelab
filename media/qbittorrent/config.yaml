#
# qBittorrent Configuration Template
# Used to generate qBittorrent.conf with environment variable substitution
#
apiVersion: v1
kind: ConfigMap
metadata:
  name: qbittorrent-config
  namespace: media
  labels:
    app: qbittorrent
    component: config
data:
  qBittorrent.conf: |
    [Application]
    FileLogger\Enabled=true
    FileLogger\Age=6
    FileLogger\AgeType=1
    FileLogger\Backup=true
    FileLogger\DeleteOld=true
    FileLogger\MaxSizeBytes=67108864
    FileLogger\Path=/config/qBittorrent/logs

    [BitTorrent]
    Session\Port=
    Session\UseRandomPort=false
    Session\Interface=
    Session\InterfaceName=tun0
    Session\InterfaceAddress=
    Session\DefaultSavePath=/downloads/torrents/complete
    Session\TempPath=/downloads/torrents/incomplete
    Session\TempPathEnabled=true
    Session\DisableAutoTMMByDefault=false
    Session\DisableAutoTMMTriggers\CategorySavePathChanged=false
    Session\DisableAutoTMMTriggers\DefaultSavePathChanged=false
    Session\GlobalMaxSeedingMinutes=-1
    Session\QueueingSystemEnabled=false
    Session\MaxActiveDownloads=-1
    Session\MaxActiveTorrents=-1
    Session\MaxActiveUploads=-1
    Session\IgnoreSlowTorrentsForQueueing=false
    Session\SlowTorrentsDownloadRate=2
    Session\SlowTorrentsUploadRate=2
    Session\SlowTorrentsInactivityTimer=60

    [Core]
    AutoDeleteAddedTorrentFile=Always

    [Meta]
    MigrationVersion=5

    [Network]
    Cookies=@Invalid()
    # No proxy configuration - traffic routed through VPN sidecar
    Proxy\OnlyForTorrents=false
    Proxy\PeerConnections=false
    Proxy\IP=
    Proxy\Port=0
    Proxy\Type=None
    Proxy\Username=
    Proxy\Password=

    [Preferences]
    # Advanced Performance Settings 
    Advanced\RecheckOnCompletion=false
    Advanced\TrayIconStyle=Normal
    Advanced\useSystemIconTheme=true
    Advanced\confirmTorrentDeletion=true
    Advanced\confirmRemoveAllTags=true
    Advanced\trackerExchangeEnabled=true
    Advanced\checkAlternativeGUI=false
    Advanced\embedTracker=true
    Advanced\superSeedingEnabled=false
    Advanced\recheckTorrentsOnCompletion=false
    Advanced\osCache=true
    Advanced\guidedReadCache=true
    Advanced\sendBufferWatermark=500
    Advanced\sendBufferLowWatermark=10
    Advanced\sendBufferWatermarkFactor=50
    Advanced\socketBacklogSize=30
    Advanced\outgoingPortsMin=0
    Advanced\outgoingPortsMax=0
    Advanced\checkingMemUsage=32
    Advanced\diskIOType=0
    Advanced\diskIOReadMode=0
    Advanced\diskIOWriteMode=0
    Advanced\coalesceReadsWrites=true
    Advanced\pieceExtentAffinity=false
    Advanced\suggestMode=false
    Advanced\sendUploadPieceSuggestions=false
    Advanced\connectionSpeed=50
    Advanced\anonymousMode=false
    Advanced\strictSuperSeeding=false
    Advanced\validateHTTPSTrackerCertificate=true
    Advanced\disableRecursiveDownload=false
    Advanced\enableEmbeddedTracker=true
    Advanced\embeddedTrackerPort=9000
    Advanced\markOfTheWeb=true
    Advanced\enableSpeedWidget=true
    Advanced\ignoreLimitsOnLAN=true
    Advanced\includeOverhead=false
    Advanced\announceIP=
    Advanced\announceToAllTrackers=true
    Advanced\announceToAllTiers=true
    Advanced\asyncIOThreads=10

    # BitTorrent Protocol Settings 
    Bittorrent\AddTrackers=false
    Bittorrent\DHT=true
    Bittorrent\Encryption=1
    Bittorrent\LSD=true
    Bittorrent\MaxConnections=-1
    Bittorrent\MaxConnectionsPerTorrent=-1
    Bittorrent\MaxRatio=-1
    Bittorrent\MaxRatioAction=0
    Bittorrent\MaxUploads=-1
    Bittorrent\MaxUploadsPerTorrent=-1
    Bittorrent\PeX=true
    Bittorrent\uTP=true
    Bittorrent\uTP_rate_limited=true
    Bittorrent\MaxTrackers=8
    Bittorrent\TrackersPorts=9000

    # Connection Settings
    Connection\PortRangeMin=58642
    Connection\PortRangeMax=58642
    Connection\UPnP=false
    Connection\ResolvePeerCountries=true
    Connection\ResolvePeerHostNames=false
    Connection\GlobalDLLimit=0
    Connection\GlobalUPLimit=0
    Connection\GlobalDLLimitAlt=0
    Connection\GlobalUPLimitAlt=0
    Connection\alt_speeds_on=false
    Connection\InterfaceListenIPv6=false
    Connection\InterfaceAddress=0.0.0.0
    Connection\InterfaceName=

    # Download Settings 
    Downloads\DiskWriteCacheSize=64
    Downloads\DiskWriteCacheTTL=60
    Downloads\SavePath=/downloads/torrents/complete
    Downloads\ScanDirsV2=@Invalid()
    Downloads\TempPath=/downloads/torrents/incomplete
    Downloads\TempPathEnabled=true
    Downloads\UseIncompleteExtension=false
    Downloads\FinishedTorrentExportDir=
    Downloads\PreAllocation=true
    Downloads\StartInPause=false
    Downloads\AutoDeleteAddedTorrentFile=Always
    Downloads\TorrentExportDir=
    Downloads\AppendExtToIncompleteFiles=false
    Downloads\CreateSubfolder=true
    Downloads\UseDownloadPath=true
    Downloads\NewAdditionDialog=false
    Downloads\NewAdditionDialogFront=true

    # RSS Settings
    RSS\AutoDownloader\DownloadRepacks=true
    RSS\AutoDownloader\SmartEpisodeFilter=s(\\d+)e(\\d+), (\\d+)x(\\d+), "(\\d{4}[.\\-]\\d{1,2}[.\\-]\\d{1,2})", "(\\d{1,2}[.\\-]\\d{1,2}[.\\-]\\d{4})"
    RSS\Session\EnableProcessing=false
    RSS\Session\MaxArticlesPerFeed=50
    RSS\Session\ProcessingEnabled=false
    RSS\Session\RefreshInterval=30

    # Scheduler 
    Scheduler\days=EveryDay
    Scheduler\end_time=@Variant(\\0\\0\\0\\xf\\x4J\\xa2\\0)
    Scheduler\start_time=@Variant(\\0\\0\\0\\xf\\x1\\xb7t\\0)

    # Search Settings
    Search\SearchEnabled=true

    # WebUI Settings
    WebUI\Address=*
    WebUI\AlternativeUIEnabled=false
    WebUI\AuthSubnetWhitelist=10.0.0.0/8,172.16.0.0/12,192.168.0.0/16
    WebUI\AuthSubnetWhitelistEnabled=true
    WebUI\BanDuration=3600
    WebUI\CSRFProtection=false
    WebUI\ClickjackingProtection=false
    WebUI\CustomHTTPHeaders=
    WebUI\CustomHTTPHeadersEnabled=false
    WebUI\HTTPS\CertificatePath=
    WebUI\HTTPS\Enabled=false
    WebUI\HTTPS\KeyPath=
    WebUI\HostHeaderValidation=false
    WebUI\LocalHostAuth=false
    WebUI\MaxAuthenticationFailCount=5
    WebUI\Port=8080
    WebUI\RootFolder=
    WebUI\SecureCookie=true
    WebUI\ServerDomains=*
    WebUI\SessionTimeout=3600
    WebUI\UseUPnP=false
    WebUI\Username=${QBITTORRENT_USERNAME}
    WebUI\Password_PBKDF2="${QBITTORRENT_PASSWORD_HASH}"
    WebUI\TrustedReverseProxiesList=

    # General Settings 
    General\AlternatingRowColors=true
    General\CloseToTray=false
    General\CloseToTrayNotified=false
    General\CustomUIThemePath=
    General\ExitConfirm=false
    General\HideZeroComboValues=0
    General\HideZeroValues=false
    General\Locale=en
    General\MinimizeToTray=false
    General\NoSplashScreen=true
    General\PreventFromSuspendWhenDownloading=false
    General\PreventFromSuspendWhenSeeding=false
    General\StartMinimized=false
    General\SystrayEnabled=false
    General\UseCustomUITheme=false
    General\UseRandomPort=false

    # Mail Notifications
    MailNotification\email=
    MailNotification\enabled=false
    MailNotification\password=
    MailNotification\req_auth=true
    MailNotification\req_ssl=false
    MailNotification\sender=qBittorrent_notification@example.com
    MailNotification\smtp_server=smtp.changeme.com
    MailNotification\username=

    # Dynamic DNS
    DynDNS\DomainName=changeme.dyndns.org
    DynDNS\Enabled=false
    DynDNS\Password=
    DynDNS\Service=0
    DynDNS\Username=

    # Speed Settings 
    Speed\GlobalDLLimit=0
    Speed\GlobalUPLimit=0
    Speed\GlobalDLLimitAlt=0
    Speed\GlobalUPLimitAlt=0
    Speed\bSchedulerEnabled=false

    # Seeding Settings 
    Seeding\GlobalMaxSeedingMinutes=-1
    Seeding\SeedChokingAlgorithm=RoundRobin
    Seeding\upload_slots_behavior=0
    Seeding\upload_choking_algorithm=1
    Seeding\announce_to_all_trackers=true
    Seeding\announce_to_all_tiers=true